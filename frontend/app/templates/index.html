<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Event Form</title>
</head>
<body>
    <h2>Enter Event Information</h2>
    <form id="eventForm">
        <label for="artist">Artist:</label><br>
        <input type="text" id="artist" name="artist"><br><br>

        <label for="venue">Venue:</label><br>
        <input type="text" id="venue" name="venue"><br><br>

        <label for="date">Date:</label><br>
        <input type="date" id="date" name="date"><br><br>

        <label for="tour">Tour:</label><br>
        <input type="text" id="tour" name="tour"><br><br>

        <input type="submit" value="Submit">
    </form>
      <!-- This is where we'll display the response from Flask -->
    <div id="responseMessage"></div>
    <hr>

    <h2>All Concerts</h2>
    <button id="loadConcerts">Load All Concerts</button>
    <table border="1" id="concertsTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Artist</th>
                <th>Venue</th>
                <th>Date</th>
                <th>Tour</th>
            </tr>
        </thead>
        <tbody id="concertsTableBody">
            <!-- Concert rows will be dynamically added here -->
        </tbody>
    </table>

    <script>
        // JavaScript to send form data as JSON using fetch
        document.getElementById('eventForm').addEventListener('submit', function(event) {
            event.preventDefault();  // Prevent the default form submission

            // Create a JavaScript object with the form data
            const formData = {
                artist: document.getElementById('artist').value,
                venue: document.getElementById('venue').value,
                date: document.getElementById('date').value,
                tour: document.getElementById('tour').value
            };

            // Send the form data as JSON to the server using fetch API
            fetch('/concert', {
                method: 'POST', 
                headers: {
                    'Content-Type': 'application/json'  // Indicate that we are sending JSON
                },
                body: JSON.stringify(formData)  // Convert the form data object to a JSON string
            })
            .then(response => response.json())  // Parse the JSON response from Flask
            .then(data => {
                // Handle success: Display the message in the responseMessage div
                const responseMessageDiv = document.getElementById('responseMessage');
                responseMessageDiv.innerHTML = `
                    <p style="color: green;">${data.message}</p>
                `;
                // Optionally reload concerts list
                fetchConcerts();
            })
            .catch(error => {
                // Handle any errors that occur during the fetch request
                const responseMessageDiv = document.getElementById('responseMessage');
                responseMessageDiv.innerHTML = `<p style="color: red;">Error: ${error}</p>`;
            });
        });

        // Fetch and display all concerts
        function fetchConcerts() {
            fetch('/allConcerts', {
                method: 'GET',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => response.json())
            .then(data => {
                const tableBody = document.getElementById("concertsTableBody");
                tableBody.innerHTML = ""; // Clear existing rows

                data.concerts.forEach(concert => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${concert._id}</td>
                        <td>${concert.artist}</td>
                        <td>${concert.venue}</td>
                        <td>${concert.date}</td>
                        <td>${concert.tour || "N/A"}</td>
                    `;
                    tableBody.appendChild(row);
                });
            })
            .catch(error => {
                console.error("Error loading concerts:", error);
            });
        }

        // Load concerts when the "Load All Concerts" button is clicked
        document.getElementById('loadConcerts').addEventListener('click', fetchConcerts);

        // Optionally load concerts automatically on page load
        // window.onload = fetchConcerts;
    </script>
</body>
</html>
